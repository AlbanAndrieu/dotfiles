# mise.toml
[tools]
# terraform = "1.14.0"
# aws-cli = "2"
# ruby = "3.4.7"
# ruby = "3.1.5"
# node = "lts"
node = "25"
go = "1.25.5"
sops = "latest"
age = "latest"
# Only install on Linux and macOS
ripgrep = { version = "latest", os = ["linux", "macos"] }
fnox = "latest"
pre-commit = "latest"
popeye = "latest"
kustomize = "latest"
krew = "latest"

[env]
# TF_WORKSPACE = "development"
AWS_REGION = "us-east-1"
# AWS_PROFILE = "dev"
AWS_PROFILE = "eks"

[tasks.plan]
description = "Run terraform plan with configured workspace"
run = """
terraform init -reconfigure -upgrade
# terraform workspace select $TF_WORKSPACE
terraform plan -parallelism=2 -lock=true
"""

[tasks.validate]
description = "Validate AWS credentials and terraform config"
run = """
aws sts get-caller-identity
terraform validate
"""

[tasks.deploy]
description = "Deploy infrastructure after validation"
depends = ["validate", "plan"]
run = "terraform apply -lock=true"
